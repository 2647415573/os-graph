第十一章多媒体操作系统 将每一部电影的起始部分放入不同的盘中，如图11-12(c)所示。第四种存放方式是采取随 机存放，如图 11-12(d)所示。 /11.7高速缓存与磁盘调度 NE 与传统OS一样，在多媒体系统中，同样需要在内存中设置高速缓存，以解决因磁盘 速度低而影响系统性能的问题。但在多媒体系统中，高速缓存的作用已与传统的操作系统 有很大的不同。另外，多媒体系统对磁盘调度提出的要求，也与传统的OS有很大的差异。 本节将对多媒体系统中高速缓存和磁盘调度做扼要阐述。

11.7.1高速缓存 一 对于传统的OS，在内存中设置高速缓存的主要目的，是为了减少对磁盘的访问时间。 所采取的方法是将那些在不久之后可能会被访问的盘块数据放入到高速缓存中，以便以后 需要时，可直接从高速缓存中读取，这样就节省了对磁盘的访问时间。然而在播放一部电 影时，通常是从头到尾顺序访问，除了某些特殊情况，如重看等，一个盘块一般不会使用 两次，因此传统高速缓存技术是不可取的。但高速缓存在多媒体系统中仍有其可用之处。

1.块高速缓存 虽说当一个用户在看一部电影时，刚放过的盘块不会被重用，但如果是有多个用户几 乎同时在看一部电影，刚放过的盘块则可能会被多次重用。例如，第一个用户于晚8点开 始观看，第二个用户8：01开始看，这样第一个用户看过的内容在1分钟后，就要被第二个 用户使用。换言之，当有多个用户几乎同时在看一部电影时，将已看过的部分放入高速缓 存是非常有效的方法。为了管理上的方便，应该在那些有多个用户几乎同时观看的电影上 标上“可高速缓存”的标记，而其它的电影就不需要高速缓存了。

2.将两条视频流合并 如果两条视频流在时间上相差很少，我们可以对两条视频流进行合并。例如，第一个 用户在晚8点观看一部电影，第二个用户在过了10秒后观看同一部电影。虽说我们可以利 用高速缓存来保留10秒钟已放过的电影，但这会要求占据很大的存储空间。一个行之有效 的方法是通过改变两部电影的播放频率，将两条视频数据流进行合并，使其成为一条视频 数据流，如图11-13所示。 图中，两部电影均以每分钟1800帧的速度播放，用户1所看电影的视频流在前，用户 2所看电影的视频流在后，为了能将这两个视频流合并，可以放慢用户1电影视频流的速 度，从每分钟1800帧降为1750帧，反之加快用户2电影视频流的速度，从每分钟1800帧 升为1850帧。在3分钟后，它们都处在第5550帧。此时可以将两个视频流合并为一个视 频流，以每分钟1800帧的正常速度播放。在此期间用户1的视频流速度放慢了2.8%，用 户2的视频流速度加快了2.8%，通常用户是感觉不出来的。 另外一个合并视频流的方法是，在用户1所播放的电影中适当地插播一些广告，用户 2仍以正常速度播放电影，经过一段时间后用户2的视频流就会赶上用户1的视频流，以 后就可以只播放一条视频流。 375  计算机操作系统 10秒钟 1分钟 2分钟 3分钟 4分钟 3 用户1 6 2 0 0 0 0 0 0 0 用户2 0 时间 开始晚于10秒 (a)两个用户观看失步10秒钟的同一部电影 较慢播放 正常速度 用户1 用户2 较快播放 正常速度 (b)将两个视频流合并为一个 图11-13将两条视频流合并

3.文件高速缓冲 在一个为公众服务的视频服务中心，通常都应当备有许多电影和电视剧节目。由于在 DVD光碟中的电影或电视剧所占用的存储空间都非常大，一般都有数GB，因而不可能都 装入视频服务器的磁盘上，而是仍然放在光盘或磁带上。在需要播放某部电影时，再将它们 复制到磁盘上。但因光盘特别是磁带的低速性，要将这些电影从光盘复制到磁盘上需要花很 多的时间。于是在大多数视频服务器中，都是将用户请求最频繁的电影文件放入内存的高速 缓冲中，而把流行的整部电影文件放在磁盘上。其它的电影文件仍然放在DVD光盘或磁带上。 还可采取另一种方法来使用高速缓冲，在磁盘中先存放每一部电影的最初几分钟片段， 当用户请求到某部电影时，先从磁盘中将该电影的第一片段复制到高速缓冲，并开始播放， 此时该电影已被复制的第一片段(部分)仍保留在磁盘中以备其它用户请求。与此同时，又 将该电影的第二个片段复制到磁盘上，继而又将它送入高速缓冲，同样其拷贝也仍保留在 磁盘上。与此同时又将该电影的第三个片段复制到磁盘上。如果在相当长时间内再无其它 用户请求，这时可从高速缓冲中清除该电影。

11.7.2静态磁盘调度 在多媒体系统中对磁盘调度提出了比传统OS更为严格的要求。其主要原因是：

（1）多媒体文件的数据量特别大，相应地要求数据传输速率也非常高。

（2）为保证电影的播放质量，要求具有很高的实时性；

(3）对于一台视频服务器，可能要同时处理成百上千的用户请求。 376  第十一章多媒体操作系统 但它也有比传统OS更容易处理的地方，即在播放时有着很强的可预测性。

1.可预测性 在传统OS中，用户对磁盘的请求是难以预测的，因此一般只提供了预读一个盘块数 据的功能。而在多媒体系统中，无论是电影还是电视剧都是连续播放的，即在播放了第i帧 后，紧接着就会播放第i+1帧，这就大大提高了请求的可预测性。例如在播放每秒25帧的 电影时，视频服务器每隔40ms就向用户提供下一帧信息。在采用双缓冲的情况时，便可在 播放第i帧时，提前从磁盘上读取第i+1帧，即实现了播放第i顿和读取第i+1帧并行处理。

2.按磁道顺序排序 相同的顿频、分辨率。这时，系统可以为每一部电影建立一个进程，在进程调度时采用轮转 法方式。首先让第一个进程运行，当它运行完后调度第二个进程运行，直至最后一个进程运 行完毕。这里的关键问题是，所有进程运行一次的时间，应小于每帧之间的时间间隔40ms。 用户所观看的10部电影被分布在不同的磁道上，应根据什么原则对磁盘请求进行排序呢？ 一种较好的方法是按请求磁道顺序号进行排序，磁道号最小的排在最前面，图11-14示出了磁 盘请求的处理顺序。由图可以看出，视频流2是最小磁道号92，因此它最先被处理；视频流 4是第二小磁道号130，因此它第二个被处理；视频流1是最大的磁道号701，因此它应最后 一个被处理。对寻道经过这样的优化后，可以大大减少处理每一个请求的平均时间。 视频流 12345678910 奇数帧的缓冲区 偶数帧的缓冲区： 0 口 请求的磁盘块 70192281130326410160466204524 L 优化算法 磁盘请求被处理的顺序 92 2130160204281326410466524701 图11-14磁盘请求的处理顺序 为了能连续不断地将视频流传送给用户，在内存中应为每个视频流设置两个缓冲区，当 有10个视频流时，便应设置20个缓冲区。在第1个帧周期，电影播放使用第一组缓冲区中 的数据，将磁盘中数据传送到第二组缓冲区。在该帧周期结束时，电影播放使用第二组缓冲 区中的数据，将磁盘中的数据传送到第一组缓冲区。此外，我们还可以增加缓冲区的大小， 使其能装入两帧数据，每一次从磁盘中读取两帧数据，这样可使磁盘的操作次数减半。

11.7.3动态磁盘调度 为简单起见，在前面曾假设，所有的电影具有相同的分辨率和帧频。现在再来分析当 多部电影具有不同的分辨率和帧频时，所播放的电影对磁盘的请求会带有一定随机性的情 况。当它们提出读磁盘请求时，需要明确指定磁盘块号以及何时需要该磁盘块中的数据， 377  计算机操作系统 亦即最终时限，错过该时间将会影响到播放质量。考虑到为读出盘块内容和对该内容进行 处理都需花费一定的时间，我们把该时间表示为△T，由此可以算出最晚读该盘块的时间应 当是T=最终时限-△T。

1.动态磁盘调度算法应考虑的因素 当第一个用户提出观看某部电影的要求时，由于此时尚无其他用户请求，故可立即获 得服务。在此期间可能会有其他用户发来请求，它们都会被挂起。当第一个用户请求完成 时，怎样从被挂起的用户请求中选择一个，即应采用什么样的磁盘调度算法，主要应考虑 这样两个因素：

（1）令磁盘总寻道时间最小，这是性能因素。为使磁盘的总寻道时间最小，在电梯调 度算法中需要根据磁盘请求中的磁道号来排序。

(2）能满足截止时间要求，这是实时因素。为使电影的播放质量能满足用户的要求， 应在截止时间前向用户提供所需的数据。

2.Scan-EDF算法 上述的性能因素和实时因素经常会发生矛盾。为了满足前者，往往会错过最终时限。 反之，为了满足后者，则又会增加总寻道时间。Scan-EDF算法同时考虑这两个因素，并将 算法的基本思想是，基于实时因素是硬性要求的这一特性，先考虑截止时间要求，将多个 截止时间相近的磁盘请求放在一个组中，由此可以形成若干个组，在每一个组中再按照磁 道序号进行排序。 我们通过图11-15所示的例子来说明该算法。当t=700时，磁盘驱动器得知：已有11 个请求因要访问本磁盘而被挂起，它们的截止时间和访问的磁道数不相同。该调度算法将

330、440、676和680。然后采用电梯调度算法对它们进行调度。只要这五个请求能在最终 时限前完成，就能保证较好的播放质量，该算法便算取得了成功。 请求(按照最终时限排序) 分批在一起 330 676 110 680 220 755280 550812103 柱面 700 710 720 730 740 750 最终时限(ms) 一 图11-15scan-EDF算法示意图 如果在运行上面的11个视频流时又收到了新的用户请求，系统是否应该接纳新的请求 呢？确定是否接纳的基本准则是，如果这次接纳并不会导致现有的视频流频繁地错过它们 的截止时间，那么就可以接纳，否则应该拒绝接纳。一个简单的方法是，计算出为一个用 户播放一部电影平均需要多少系统资源量，包括内存和磁盘空间，以及所需的处理机时间 等，如果现有的所有资源都能满足要求，就可以接纳，否则拒绝接纳。 378  第十一章多媒体操作系统 另一个计算方法更为细致，虽然是否接纳的基本准则是相同的，但该方法要进一步考 虑用户所要看的电影的特性。由于不同性质的电影具有不同的分辨率和数据率。如黑白电 影的数据率要比彩色电影的低得多，所需的各种资源都会少得多。如果在某个时刻，系统 中所剩余的资源足以播放一部黑白片，但不能满足播放一部彩色片的需要，若此时用户请求 的就是一部黑白片，就可以接纳他的请求；但如果用户请求的是一部彩色片，则拒绝接纳。

1.试说明多媒体文件有哪些特点。

2.多媒体的集成性包含了哪几方面的含义？

3.在计算机系统中，为了进行图像、音频信号和视频信号的处理，需要增加哪些硬件？

4.常用的数字音频文件有哪几种类型？

5.彩色电视的制式有哪几种？我国采用的是哪一种？

6.简单说明几种常用的MPEG标准。

7.试说明在多媒体系统中，对实时任务的处理有何需求。

8.在多媒体系统中，进程管理中必须解决哪些问题？

9.什么是SRT任务带宽和尽力而为任务带宽？为什么要设置这两种带宽？

10.CPU代理的主要任务是什么？在什么情况下可以接收新进程？

11.什么是预留策略？预留策略涉及哪些重要问题？

12.速率单调调度RMS算法里的优先级是如何确定的？该算法需满足什么样的条件？

13.试对EDF算法与RMS调度算法进行比较。

14.何谓拉型和推型文件服务器？它们分别适用于何种场合？

15.试比较一般的文件服务器和媒体服务器。

16.何谓存储器页面锁定功能？在多媒体系统中为什么需要该功能？

17.存储器代理的主要任务是什么？它是如何来实现该任务的？

18.媒体服务器接纳控制的主要任务是什么？它是如何实现接纳控制的？

19.为了满足不同用户的需要，媒体服务器可以提供哪几种服务质量保证？

20.把多媒体文件存放在硬盘上时，为什么要采取交叉连续存放方式？

21.什么是帧索引存放方式？什么是块索引存放方式？

22.试对帧索引存放方式的性能进行分析。

23.试对块索引存放方式的性能进行分析。

24.什么是近似视频点播？近似视频点播的文件应如何存放？

25.当两条视频流在时间上相差很少时，为什么要将它们合并？如何合并？

26.什么是Zipf定律？按照管风琴算法规定，在单个磁盘上应如何存放多部电影？

27.高速缓存在多媒体系统中可有哪些用处？

28.为什么在多媒体系统中对磁盘调度提出了比传统OS更为严格的要求？

29.多媒体系统中对磁盘调度比传统OS更为容易处理的地方又有哪些？

30.为什么说can-EDF算法既能满足实时性要求，又可获得较好的性能？ 379