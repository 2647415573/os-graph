第十章多处理机操作系统 制的中心处理机上，配置一张整个系统的进程资源图，并设置一个检测进程，负责整个系 统的死锁检测。当检测进程检测到环路时，就选择中止环路中的一个进程，以解决死锁。 为了及时获得最新的进程和资源状况，检测进程对各个结点更新信息的获得，可以通 过三种方式：①当资源图中加入或删除一条弧时，相应的变动消息就发送给检测进程； ②每个进程将新添加或删除的弧的信息周期性地发送给检测进程；③检测进程主动去请 求更新信息。 上述方式有个不足之处在于，由于进程发出的请求与释放资源命令的时序与执行这两 条命令的时序有可能不一致，以至于在进程资源图中形成了环形链，然而是否真的发生了 死锁，却无法判断。对此，一种合适的解决办法是：当检测进程发现这种情况后，需要再 则确认为假死锁。 2）分布式检测 分布式检测是通过系统中竞争资源的各个进程间的相互协作，实现对死锁的检测，无 需设置一个检测进程，专门用于对全局资源使用情况进行检测。该方式在每个结点中都设 排队，在一个进程对某资源操作前，必须先向所有其它进程发送请求信息，在获得这些进 程的响应信息后，才把请求资源的消息发给该资源的管理进程。每个进程都要将资源的已 分配情况通知所有进程。 由上述可见，对于分布式环境下的死锁检测，需要的通信开销较大，在实际应用中， 往往采取的是死锁预防方式。

10.6网络操作系统 计算机网络是指通过数据通信系统把地理上分散的自主计算机系统连接起来，以达到 数据通信和资源共享目的的一种计算机系统。自主计算机是指具有独立处理能力的计算机。 可见，计算机网络是在计算机技术和通信技术高度发展的基础上相结合的产物，是多个处 理机通过通信线路互连而构成的松散耦合系统，通信系统为计算机之间的数据传送提供最 重要的支持。作为多处理机系统的一种重要形式，本节将对网络操作系统作简要的介绍。

10.6.1：网络及网络体系结构

1.计算机网络的组成 计算机网络从构造的物理结构而言，是通过包括星形、树形、公用总线形、环形和网 状形等不同的拓扑结构，将地理上分散的计算机连接起来的网络。而从逻辑结构而言，计 算机网络是由三个部分组成：

（1）通信子网：由分布在不同地点的、负责数据通信处理的通信控制处理机与通信线 路互连构成，是计算机网络的基础部分，主要负责数据的传输及交换。

(2）资源子网：由负责数据处理的主计算机与终端构成，作为计算机网络中的信源和 信宿，都连接在通信子网中的一个交换设备上，构成了建立在通信子网上的资源子网，负 333  计算机操作系统 责进行数据处理。

(3）网络协议：为实现计算机网络中的数据交换而建立的规则、标准或约定的集合， 是为了保证网络中源主机系统和目标主机系统保持高度一致的协同。

2.网络协议 网络协议是一组控制数据交互过程的通信规则，规定了通信双方所交换数据(控制信息) 的格式和时序。网络协议的三要素分别是：

（1）语义，解释控制信息每个部分的意义，规定了通信双方要发出的控制信息、执行 的动作和返回的应答等；

（2）语法，规定通信双方彼此应该如何操作，即确定协议元素的格式，包括用户数据 与控制信息的结构与格式，以及数据出现的顺序；

（3）时序，对事件发生顺序的详细说明，指出事件的顺序和速率匹配等。 在网络的每一层中都有相应的网络协议。（N)协议是指一组局部于(N)层的协议，它决 定着(N)实体在执行(N)功能时的通信行为。 计算机网络中存在有多种协议，每个协议应该处理没有被其它协议处理过的通信问题， （即内聚性高，耦合性低），同时每个协议之间可以共享数据和信息。 网络的协议具有两种形式：一是便于人进行阅读和理解的文字描述；二是能够让计算 机理解的程序代码。两种不同形式的协议都必须能够对网络上交换的信息做出精确的解释 和规定。

3.互连网协议IPv4和IPv6 1）IPv4协议 IPv4是早期在Internet上使用的网络互连协议，可利用它来实现网络互连，为此，IPv4 实体，应为这些实体赋予全局性标识符；②分段和重新组装，在不同的网络中，所规定的 顿长度并不相同，例如在X.25网中优先选用的最大长度为128个字节，而在以太网中则为 1518个字节，这样，当信息从以太网送入X.25网时，就应先进行分段，在由WAN把信息 传送到目标LAN后，又应对它们进行重新组装；③源路由选择，为IP数据报的传输，选 择最佳的传输路由。 2)IPv6协议 IPv6协议继承了IPv4协议的一切优点，而针对其不足之处做了多方面的修改，使之 能更好地满足当今Internet网络的需要。如扩大了地址空间，IPv4协议的规定地址长度为 4个字节，而在IPv6协议中的地址长度已扩充到16个字节；又如增设了安全机制，在IPv6 协议中引入了认证技术，以保证被确认的用户仅能去做已核准他执行的操作等。

4.传输层协议TCP和UDP 1）传输控制协议TCP TCP提供了面向连接的、可靠的端-端通信机制。所谓可靠，是指即使网络层（通信子 网)出现了差错，TCP协议仍能正确地控制连接的建立、数据的传输和连接的释放。此外， 在进行正常的数据交换时也要有流量控制，即控制发方发送数据的速度不应超过接收方接 收数据的能力。 334  第十章多处理机操作系统 2）用户数据报协议UDP 如果所传输的数据并不那么重要，可考虑利用UDP协议来传输数据。该协议是一种无 连接的、不可靠的协议。它无需在数据传送之前先建立端-端之间的连接，也就不要拆除连 接。在数据传送过程中，无需对传送的数据进行差错检测。换而言之，它是以一种比较简 单的方式来传送数据，因而有效地提高了传输速率。

5.网络体系结构 为了简化对复杂的计算机网络的研究、设计和分析工作，一般把计算机网络的功能分 成若干层。层次结构就是指把一个复杂的系统设计问题分解成多个层次分明的局部问题， 并规定每一层次所必须完成的功能。 计算机网络的体系结构就是这个计算机网络及其部件所应完成功能的精确定义，是针 之间的互连、互通和互操作提供相应的规范和标准(即协议)。网络体系结构是抽象的，而 实现网络协议的技术是具体的。 在开放系统互连参考模型OSI/RM(OpenSystemInterconnection/ReferenceModel)的网 络体系结构中，从最低物理层，到最高应用层共分为七层，如图10-9所示，各层的功能 如下：

（1）物理层（PhysicalLayer)：是OSI的最低层，建立在通信介质的基础上，实现系统和 通信介质的接口功能，为数据链路实体之间透明地传输比特流提供服务。

(2）数据链路层(DataLinkLayer)：是在相邻两系统的网络实体之间，建立、维持和释 放数据链路连接，在两个相邻系统的网络实体之间实现透明的、可靠的信息传输服务。数 据传输的基本单位是帧。

（3）网络层（NetworkLayer)：网络层主要涉及通信子网及与主机的接口，提供建立、维 持和释放网络连接的手段，以实现两个端系统中传输实体间的通信。传输的基本单位是分 组（packet)。

（4）传输层（TransportLayer）：为不同系统内的会唔实体间建立端-端（end-to-end)的透 明、可靠的数据传输，执行端-端差错控制及顺序和流量控制，管理多路复用等。数据传输 的基本单位是报文(message)。 主机系统 主机系统 应用层协议 应用层 表示层协议 表示层 会唔层协议 会唔层 传输层协议 传输层 网络层 网络层 数据链路层 数据链路层 物理层 物理层 物理介质 图10-9OSI七层模型 335  计算机操作系统

(5）会唔层(SessionLayer)：为不同系统内的应用进程之间建立会唔连接。会唔层的作 用是对基本的传输连接服务进行“增值”，以提供一个能满足多方面要求的会唔连接服务。

(6）表示层(PresentationLayer)：向应用进程提供信息表示方式、对不同系统的表示方 法进行转换，使在采用不同表示方式的应用实体之间能进行通信，并提供标准的应用接口 和公用通信服务，如数据加密、正文压缩等。

(7）应用层(ApplicationLsyer)：是OSI/RM中的最高层，它为应用进程访问OSI环境 提供了手段，并直接为应用进程服务，其它各层也都通过应用层向应用进程提供服务。 OSI参考模型层次划分的原则：①网络中各主机都具有相同的层次；②不同主机的 同等层具有相同的功能；③同一主机内相邻层之间通过接口通信：④每层可以使用下层提 供的服务，并向其上层提供服务；5不同主机的同等层通过协议来实现同等层之间的通信。

10.6.2网络操作系统及其分类

1.网络操作系统及其特征 网络操作系统(NetworkOperatingSystem)是在计算机网络环境下，对网络资源进行管理 和控制，实现数据通信及对网络资源的共享，为用户提供与网络资源之间接口的一组软件 和规程的集合。网络操作系统建立在网络中计算机各自不同的单机操作系统之上，为用户 提供使用网络系统资源的桥梁。一般而言，网络操作系统具有下面5个特征。

（1）硬件独立性：系统可以运行于各种硬件平台之上。例如，可以运行于Intelx86系 统，也可以运行于基于RISC精简指令集的系统，诸如DECAlpha、MIPSR4000等。

(2）接口一致性：系统为网络中的共享资源提供一致性的接口，即对同一性质的资源 采用统一的访问方式和接口。

(3）资源透明性：对网络中的资源统一管理，能够根据用户的要求，自动地分配和 选择。

（4）系统可靠性：系统利用资源在地理上分散的优点，通过统一管理、分配和调度手 段，确保了整个网络的安全可靠。如果一个节点和通信链路出现故障，可以屏蔽该节点或 重新定义新的通信链路，保证网络的正常运行。

（5）执行并行性：系统不仅实现了在每个节点计算机中各道进程的并发执行，而且实 现了网络中多个节点计算机上进程的并行执行。

2.网络操作系统的分类 组建计算机网络的基本目的是共享资源，根据对共享资源不同的组织、控制和数据处 理方式，从历史发展来看，计算机网络应用模式可分为主从模式、对等模式和基于服务器 模式三类。其中的主从模式前面已经介绍过了，下面介绍其它两类。基于服务器模式又可 分为专用文件服务器模式（也称工作站服务器模式）、客户机服务器模式和浏览器服务器模 式。所以，对应地，将网络操作系统的工作模式也分为两大类共四种模式： 1）对等模式(peer-to-peer model) 服务器，任何一台计算机和其它计算机之间没有从属关系。原则上网络中的任意两个节点 之间都直接通信，系统中的每一台计算机都能访问计算机上的共享资源，每台联网计算机 336  第十章多处理机操作系统 都分前台方式和后台方式工作，前台为本地服务，后台为其它结点的网络用户服务。 该模式适用于较小范围和规模的网络，其优点在于结构简单，容易安装和维护，网络 中任意两个节点均可直接通信。其缺点在于对网络中每一个节点的计算机负载过重，既要 承担本地用户的信息处理任务，又要承担较重的网络共享资源管理和通信管理任务，明显 降低了信息处理能力。 2）工作站/服务器模式（Workstation/Servermodel) 该模式将网络中的节点计算机分为两类：网络服务器（Server)和网络工作站 （Workstation)。服务器以集中方式管理网络中的共享资源，为工作站提供服务，服务器不再 作其它用途。工作站为本地用户访问本地资源和访问网络资源服务。 非对等网络的操作系统的软件也分为两部分：一部分运行在服务器上，另一部分运行 在工作站上。服务器集中管理网络资源和服务，是局域网的逻辑中心。安装在服务器上的 网络操作系统软件的功能和性能决定了网络服务功能的强弱以及系统的性能和安全性，是 网络操作系统的核心部分，也称为基于专用服务器的网络操作系统。 绝大多数网络都是采用非对等结构的网络操作系统，可用于大型系统的联网。典型的 非对等结构网络操作系统有Novell公司的NetWare和Microsoft公司的WindowsNT等。 3）客户/服务器模式（Client/Servermodel） 在计算机网络中，从硬件角度看，客户/服务器模式是指，某项任务分配在两台或多台 机器上，其中用于接受请求并提供各种资源、数据和服务的计算机称为服务器，而面向用 户，提供用户接口和前端处理，并向服务器提出资源、数据和服务请求的计算机称为客 户机。 从软件角度看，客户/服务器模式是指，将某项应用或软件系统按逻辑功能，划分为客 户端软件和服务器软件两个部分。前者负责数据的表示和应用、用户界面的处理、接收用 户的数据处理请求、向服务器发出数据和服务请求。后者负责接收客户端软件发来的请求 并提供相应的服务。 客户与服务器之间采用网络协议（如TCP/IP、IPX/SPX）进行连接和通信，其交互模式 一般为：客户端向服务器发出请求，服务器端接收请求并执行相应服务，服务器回送响应 包，客户端接收响应包。 4）浏览器/服务器模式（Browser/Servermodel） 客户/服务器模式可分为两层C/S模式和三层C/S模式两种。传统的小型局域网采用两 层客户/服务器模式，在大型网络中通常采用三层C/S模式。三层C/S模式，即将客户机连 接到一台Web服务器（并配上浏览器软件，用于实现客户与Web服务器之间的交互）上，即 在客户机与服务器之间再增加一台Web服务器，它相当于前面所介绍的应用服务器。 当客户机需要访问各种服务器时，用户须先访问Web服务器，然后由Web服务器代理 客户去访问某台（些）服务器。由于配置了浏览器软件的客户机可以浏览网络中几乎所有允 许访问的服务器，这时便把这样的客户机称为Web浏览器，由此形成了Web浏览器、Web 服务器和数据库服务器三层的C/S模式，通常也称为浏览器/服务器模式。 浏览器与服务器之间的交互，与传统C/S之间的交互方式相似，都属于请求/响应方式， 337  计算机操作系统 所不同的是浏览器所检索的对象通常是超文本文件，因此在浏览器与Web服务器之间所采 用的是HTTP传输协议。

10.6.3网络操作系统的功能 网络操作系统不仅涵盖了单机操作系统的全部功能，还具有支持数据通信、应用互操 作、网络管理等功能。

1.数据通信 为了实现网络中计算机之间的数据通信，网络OS应具有如下基本功能：

（1）连接的建立与拆除。为实现两计算机系统之间的通信，需要在两个系统的多个层 次之间建立连接：①在相邻两个系统的物理层之间建立物理连接，为信息传输提供一条物 理传输路径；②在相邻结点的数据链路层间建立数据链路连接，以实现相邻结点间无差错 的信息传输；③在网络层中，又须在源传输实体和目标实体之间建立一条网络连接，直至 在两系统的表示层中，为两个应用实体建立了表示连接，即除应用层外的所有各层都要为 数据通信建立相应的连接。当通信结束后，又须将各层中的相应连接拆除。

（2）报文的分解与组装。在源主机中将用户数据由传输层送至网络层之前，应将用户 数据（报文）分解成若干个适合在网络中传输的分组，然后逐个按序将它们送至网络层。再 由网络层把分组发送给网络中的下一个结点。当这些分组到达目标主机后，再由目标主机 中的传输层按分组序号，将这些分组重新组装成报文，再通过会唔层、表示层送给应用层 中的目标进程。

(3）传输控制。为使用户数据（报文）能在网络中正常传输，必须为报文配上报头来控制报 文传输，报头中的内容是用于控制报文传输的信息，如目标地址、源主机地址、报文序号等。

（4）流量控制。从源实体所发出数据的速度，不应超过目标实体接收和处理数据的能 力，以及链路的传输能力，这就是流量控制功能。

(5）差错的检测与纠正：数据在网络中传输时难免会出现差错，为了减少数据在传输 过程中的错误，网络中必须有差错控制设施以完成检测差错（即发现数据在传输过程中所出 现的错误）和纠正错误（即对已发现的错误加以纠正）。

2.应用互操作 为了实现多个网络之间的通信和资源共享，不仅需要将它们从物理上连接在一起，而 且还应使不同网络的计算机系统之间能进行通信（信息互通）和实现资源共享（信息互用）。为 此，在网络OS中必须提供应用互操作功能，以实现“信息互通性”及“信息互用性”。

（1）信息的互通性。为了避免在不同的网络中，因采用了不同的协议而不能相互识别 和通信，在互连网络的每一个网络中都应配置同一类型的传输协议，以实现各个网络之间 的通信。如互连网络Internet（互联网），是由成千上万个各种类型的WAN互连而成的，所 有这些网络都是利用TCP/DP传输协议来实现信息互通的，如果用户希望把自己的网络连接 到Internet上，就必须在自己的网络中配置TCP/IP传输协议。

(2）信息的“互用性”。所谓信息的“互用性”，是指在不同的网络中的站点之间能实 现信息的互用，亦即一个网络中的用户能够访问另一个网络文件系统（或数据库系统）中的 文件（数据）。不能实现信息的“互用性”的原因是，在不同网络中所配置的网络文件系统（或 338  第十章多处理机操作系统 数据库系统），通常都使用了各不相同的结构、各不相同的文件命名方式和存取文件的命令， 于是便发生了由一个源网络中的用户发往一个目标网络去的文件访问命令不能被目标网络 上的结点所识别的情况。对此，一个当前相对比较流行的解决方案是由SUN公司推出的网 络文件系统协议NFS(NetworkFileSystem)。

3.网络管理 在网络中引入了网络管理功能，以确保能最大限度地增加网络的可用时间，提高网络 设备的利用率，改善网络的服务质量，以及保障网络的安全性等。 1）网络管理的目标

（1）增强网络的可用性，如通过预测及时地检测出网络故障，为关键设备配置余的 设备等；

(2）提高网络的运行质量，随时监测网络中的负荷及流量；

(3）提高网络的资源利用率，长期监测网络，对网络资源进行合理的调整；

（4）保障网络数据的安全性，采取多级安全保障机制；

（5）提高网络的社会和经济效益。 2）网络管理的功能 ISO为网络管理定义了差错、配置、性能、计费和安全五大管理功能：

（1）配置管理，用来监控网络的配置数据，允许网络管理人员能生成、查询和修改软 硬件的运行参数和条件，以保证网络正常运行；

(2）故障管理，通常用来检测网络中所发生的异常事件，为网络操作员提供快速发现 和修复故障的手段；

(3）性能管理，通过收集网络运行数据，分析网络的运行情况以及网络的运行趋势， 得出对网络的整体和长期的评价，将网络性能控制在用户能接受的水平；

(4）安全管理，提供某种安全策略来控制对资源的访问，包括定义合法操作员及其权 限和管理域，规定用户对网络资源的访问权限，通过使用日志等手段对所关心的事件进行 调查，防止病毒等；

(5）计费管理，用于监视和记录用户使用网络资源的种类、数量和时间，对资源的使 用进行计费。

710.7分布式文件系统 前面章节介绍的文件系统，其所管理的存储设备是连接在本地节点（本地计算机）上的， 仅允许本地的CPU通过系统IVO总线直接访问，我们称之为本地文件系统(LocalFile System，LFS)。而分布式文件系统(DistributedFileSystem，DFS)是指建立在松散耦合的多 处理机体系结构上，通过通信网络(或计算机网络)互连，将分布在本地或远地若干节点的 物理存储设备以共享文件系统方式统一管理，提供给不同节点上的用户共享。DFS的设计 基于客户机/服务器模式，是一个相对独立的软件系统，被集成在分布式操作系统中。 分布式文件系统是配置在分布式系统上的，因此，本节在介绍分布式文件系统这个主 339